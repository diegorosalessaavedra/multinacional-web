'use client'
import useIntersectionObserverOnResize from '@/hooks/useIntersectionObserverOnResize'
import './usInFigures.css'
import { useEffect, useState } from 'react'

export default function UsInFigures() {
  const [transportedWeight, setTransportedWeight] = useState<number>(0)
  const [deliveredPackages, setDeliveredPackages] = useState<number>(0)
  const [kilometer, setKilometer] = useState<number>(0)
  const [hasAnimated, setHasAnimated] = useState<boolean>(false) // Para evitar múltiples ejecuciones

  const animateNumber = (
    setter: React.Dispatch<React.SetStateAction<number>>,
    target: number,
    duration: number
  ): void => {
    let start = 0
    const increment = target / (duration / 20) // Ajusta la velocidad
    const interval = setInterval(() => {
      start += increment
      if (start >= target) {
        start = target
        clearInterval(interval)
      }
      setter(Math.floor(start))
    }, 30)
  }
  useEffect(() => {
    const target = document.getElementById('usInFigures_articles')
    if (!target) return

    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting && !hasAnimated) {
          setHasAnimated(true) // Evita que se repita la animación
          animateNumber(setTransportedWeight, 58, 1500)
          animateNumber(setDeliveredPackages, 950, 1500)
          animateNumber(setKilometer, 989, 1500)
        }
      },
      { threshold: 0.5 } // Se activa cuando el 50% del elemento es visible
    )

    observer.observe(target)

    return () => observer.disconnect() // Limpieza al desmontar
  }, [hasAnimated])

  useEffect(() => {
    animateNumber(setTransportedWeight, 58, 1500) // 2 segundos de animación
    animateNumber(setDeliveredPackages, 950, 1500)
    animateNumber(setKilometer, 989, 1500)
  }, [])

  useIntersectionObserverOnResize('usInFigures')

  return (
    <div className="usInFigures_container">
      <section className="usInFigures" id="usInFigures">
        <h2 className="usInFigures_title">Nosotros en cifras</h2>
        <div className="usInFigures_articles" id="usInFigures_articles">
          <article className="usInFigures_article">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              className="img-fluid"
              width="220"
              height="220"
              viewBox="0 0 220 220"
            >
              <g className="icon-truck" transform="translate(930 -1305)">
                <circle
                  className="circle"
                  cx="110"
                  cy="110"
                  r="110"
                  transform="translate(-930 1305)"
                ></circle>
                <path
                  className="icon"
                  d="M102.83,74.375c0-.1,0-.191,0-.286H53.651c0,.1,0,.191,0,.286a13.844,13.844,0,1,1-27.688,0c0-.1,0-.191,0-.286H11.428A2.038,2.038,0,0,1,9.39,72.05V64.608H2.039a2.038,2.038,0,1,1,0-4.077H23.279a2.038,2.038,0,1,1,0,4.077H13.468v5.4h13.2a13.846,13.846,0,0,1,26.28,0H98.364V53.272a2.039,2.039,0,0,1,4.078,0v16.74h1.093a13.846,13.846,0,0,1,26.28,0h6.108V59.99h-2.7a6.787,6.787,0,0,1-6.779-6.78V48.835A2.038,2.038,0,0,1,128.48,46.8h7.2a7.822,7.822,0,0,0-7.569-5.89H102.442v3.139a2.039,2.039,0,0,1-4.078,0V4.078h-84.9V44.046a2.039,2.039,0,0,1-4.078,0V2.039A2.038,2.038,0,0,1,11.428,0H100.4a2.039,2.039,0,0,1,2.039,2.039V9.3H119.7a8.277,8.277,0,0,1,8.267,8.267v2.523a2.038,2.038,0,0,1-1.974,2.037l3.739,14.812A11.9,11.9,0,0,1,140,48.714V72.05a2.039,2.039,0,0,1-2.039,2.039h-7.445c0,.1,0,.191,0,.286a13.844,13.844,0,1,1-27.688,0Zm4.077,0a9.761,9.761,0,1,0,.2-1.968q-.008.045-.018.09A9.774,9.774,0,0,0,106.907,74.375Zm-76.864,0A9.767,9.767,0,1,0,49.4,72.5q-.01-.046-.018-.092a9.767,9.767,0,0,0-19.334,1.969ZM130.519,53.211a2.7,2.7,0,0,0,2.7,2.7h2.7V50.873h-5.4ZM125.5,36.829l-3.711-14.7H102.442v14.7ZM123.89,18.049v-.483a4.2,4.2,0,0,0-4.19-4.19H102.442v4.674H123.89ZM111.445,74.375a5.23,5.23,0,1,1,5.229,5.23A5.235,5.235,0,0,1,111.445,74.375Zm4.078,0a1.152,1.152,0,1,0,1.151-1.152A1.153,1.153,0,0,0,115.523,74.375Zm-80.943,0a5.23,5.23,0,1,1,5.231,5.23A5.236,5.236,0,0,1,34.58,74.375Zm4.078,0a1.152,1.152,0,1,0,1.153-1.152A1.154,1.154,0,0,0,38.658,74.375ZM57.83,64.608a2.038,2.038,0,1,1,0-4.077H91.2a2.038,2.038,0,0,1,0,4.077Zm-51.415-9.3a2.039,2.039,0,0,1,0-4.078H34.857a2.039,2.039,0,1,1,0,4.078ZM52.15,45.369l-11.9-11.9a2.039,2.039,0,1,1,2.884-2.883L53.59,41.044,73.344,21.29a2.039,2.039,0,0,1,2.884,2.884L55.032,45.369a2.037,2.037,0,0,1-2.883,0Z"
                  transform="translate(-890 1371.114)"
                ></path>
              </g>
            </svg>{' '}
            <p className="usInFigures_article-p">{transportedWeight.toLocaleString()}mil</p>
            <h3 className="usInFigures_article-h3">Kilos transportados</h3>
          </article>
          <article className="usInFigures_article">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              className="img-fluid"
              width="220"
              height="220"
              viewBox="0 0 220 220"
            >
              <g className="icon-boxes" transform="translate(843 -1573)">
                <circle
                  className="circle"
                  cx="110"
                  cy="110"
                  r="110"
                  transform="translate(-843 1573)"
                ></circle>
                <path
                  className="icon"
                  d="M202.291,595.012a17.017,17.017,0,0,1-11.568-29.492l-28.911-79.434-24.136,8.785a2.042,2.042,0,0,1-2.614-1.219l-3.031-8.328a2.041,2.041,0,0,1,1.219-2.614l26.051-9.481a11.129,11.129,0,0,1,14.263,6.651L203.1,561.025a17.011,17.011,0,0,1,4.148.731L195.5,529.49l0-.01,0-.009-12.208-33.543a2.039,2.039,0,0,1,1.219-2.613l28.507-10.376.029-.01,17.8-6.479a2.041,2.041,0,0,1,2.613,1.219l3.847,10.57a2.039,2.039,0,1,1-3.832,1.4l-3.15-8.655-14,5.1,3.024,8.308a2.04,2.04,0,0,1-1.219,2.614l-10.223,3.72a2.039,2.039,0,0,1-2.612-1.219l-3.024-8.307-14.452,5.26,10.817,29.72,26.59-9.679.028-.01L241.14,510.7l-4.957-13.619a2.039,2.039,0,1,1,3.832-1.4l19.947,54.8,6.412-2.334a2.038,2.038,0,0,1,2.613,1.219l2.8,7.687a2.04,2.04,0,0,1-1.219,2.614l-51.292,18.668a17.007,17.007,0,0,1-16.983,16.669Zm-6.861-27.97a13,13,0,1,0,2.423-1.179h0l-.1.035-.01,0a12.972,12.972,0,0,0-2.314,1.138Zm22,3.266a17.1,17.1,0,0,1,1.4,3.854l48.417-17.622-1.4-3.856Zm-4.852-5.816a16.963,16.963,0,0,1,2.5,2.332l41.048-14.94-13.6-37.354-14,5.1,3.024,8.308a2.041,2.041,0,0,1-1.219,2.614l-10.223,3.72a2.039,2.039,0,0,1-2.613-1.219l-3.023-8.307L200.029,530ZM163.03,481.433a2.04,2.04,0,0,1,1.916,1.342l29.221,80.284a17.2,17.2,0,0,1,2.292-1.029,17.012,17.012,0,0,1,2.418-.684l-29.144-80.072a7.049,7.049,0,0,0-9.037-4.214l-24.136,8.783,1.637,4.5,24.136-8.785A2.038,2.038,0,0,1,163.03,481.433Zm55.283,41.914,2.326,6.391,6.392-2.326L224.7,521.02ZM206.1,489.8l2.326,6.391,6.392-2.326-2.326-6.391Zm-3.82,94.8a6.584,6.584,0,0,1-2.259-12.771h0a6.584,6.584,0,1,1,2.258,12.771Zm-.864-8.938h0a2.506,2.506,0,1,0,3.212,1.5A2.509,2.509,0,0,0,201.418,575.654Z"
                  transform="translate(-934.909 1149.004)"
                ></path>
              </g>
            </svg>
            <p className="usInFigures_article-p">{deliveredPackages.toLocaleString()}mil</p>
            <h3 className="usInFigures_article-h3">Cajas transportadas</h3>
          </article>
          <article className="usInFigures_article">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              className="img-fluid"
              width="220"
              height="220"
              viewBox="0 0 220 220"
            >
              <g className="icon-travel" transform="translate(429 -1573)">
                <circle
                  className="circle"
                  cx="110"
                  cy="110"
                  r="110"
                  transform="translate(-429 1573)"
                ></circle>
                <path
                  className="icon"
                  d="M7.551,132.59C-2.736,122.3-2,102.91,8.515,81.029A62.548,62.548,0,0,1,9.943,52.956L1.527,50.77A2.039,2.039,0,0,1,.6,47.354l6.94-6.941a1.973,1.973,0,0,1,1.483-.6l11.308.226L33.616,26.755,12.4,10.033a2.039,2.039,0,0,1-.179-3.044l5.663-5.661a2.035,2.035,0,0,1,2.318-.4L46.789,13.581l6.821-6.82A22.16,22.16,0,0,1,67.712.328L72.274,0a2.041,2.041,0,0,1,2.179,2.179l-.323,4.562a22.161,22.161,0,0,1-1.3,6.07c25.359-14.66,48.305-16.9,59.849-5.351,10.108,10.108,9.727,29.37-.989,51.614q.219,1.241.389,2.5a62.151,62.151,0,0,1,.561,7.936q.007.085.007.171t-.006.155a62.952,62.952,0,0,1-7.659,30.225A2.04,2.04,0,1,1,121.4,98.1,57.988,57.988,0,0,0,128.5,71.722H90.262A10.839,10.839,0,0,1,79.435,60.9V60.6A10.547,10.547,0,0,1,89.969,50.069,2.67,2.67,0,0,0,92.637,47.4V46.139A14.11,14.11,0,0,1,106.73,32.045h7.814q-1.473-1.726-3.1-3.352A58.132,58.132,0,0,0,81.662,12.718,128.631,128.631,0,0,0,67.844,20.7l-.148.149-6.82,6.821L73.528,54.251a2.038,2.038,0,0,1-.4,2.318l-5.662,5.662a2.038,2.038,0,0,1-3.044-.179L47.7,40.842,34.415,54.129l.226,11.309a2.043,2.043,0,0,1-.6,1.481L27.1,73.859a2.037,2.037,0,0,1-1.442.6,2.014,2.014,0,0,1-.536-.072,2.039,2.039,0,0,1-1.439-1.455l-1.779-6.848a132.693,132.693,0,0,0-9.125,15.541,58.722,58.722,0,0,0,46.035,45.81,2.045,2.045,0,0,1,.861.163,58.3,58.3,0,0,0,17.116.561V120.7a6.98,6.98,0,0,0-6.972-6.972H56.851a9.914,9.914,0,0,1-9.9-9.9,3.3,3.3,0,0,0-3.3-3.3H39.688a12.027,12.027,0,0,1-.318-24.05v-.944a7.9,7.9,0,0,1,7.889-7.889H63.4A12.9,12.9,0,0,1,76.282,80.526V92.173a1.75,1.75,0,0,0,1.749,1.749h2.985a10.317,10.317,0,0,1,10.3,10.305v7.232a2.039,2.039,0,0,1-4.079,0v-7.232A6.232,6.232,0,0,0,81.016,98H78.031A5.835,5.835,0,0,1,72.2,92.173V80.526a8.814,8.814,0,0,0-8.8-8.8H47.26a3.814,3.814,0,0,0-3.81,3.811V76.79a3.766,3.766,0,0,1-3.762,3.762,7.948,7.948,0,0,0,0,15.9h3.961a7.385,7.385,0,0,1,7.377,7.377,5.831,5.831,0,0,0,5.825,5.824H69.823A11.063,11.063,0,0,1,80.874,120.7v6.84a58.3,58.3,0,0,0,22.9-9.713,58.979,58.979,0,0,0,7.672-6.466,2.039,2.039,0,1,1,2.884,2.884,63.12,63.12,0,0,1-8.2,6.915,62.373,62.373,0,0,1-26.638,10.755,2.036,2.036,0,0,1-.657.108h-.075a62.358,62.358,0,0,1-19.673-.384c-11.457,5.51-22.123,8.275-31.149,8.275C19.466,139.912,12.439,137.478,7.551,132.59ZM5.34,102.313c-2.487,12.1-.724,21.573,5.1,27.393,8.129,8.129,23.638,8.2,42.14.4A62.9,62.9,0,0,1,10.051,87.573,79.379,79.379,0,0,0,5.34,102.313ZM11.81,74.668a144.675,144.675,0,0,1,8.747-13.785l-1.44-5.543-5.225-1.357A58.6,58.6,0,0,0,11.81,74.668ZM21.3,51.692a2.038,2.038,0,0,1,1.462,1.461l3.974,15.3,3.806-3.806-.226-11.307a2.038,2.038,0,0,1,.6-1.483L46.441,36.335a2.04,2.04,0,0,1,3.044.179l16.721,21.21,3.02-3.02L56.573,28.121a2.039,2.039,0,0,1,.4-2.318l7.444-7.444a2.033,2.033,0,0,1,.661-.721l.14-.093A18.071,18.071,0,0,0,70.061,6.458l.157-2.219L68,4.4A18.08,18.08,0,0,0,56.494,9.644l-7.839,7.839a2.04,2.04,0,0,1-2.319.4L19.753,5.231l-3.02,3.02L37.944,24.973a2.038,2.038,0,0,1,.178,3.043L22.6,43.54a1.978,1.978,0,0,1-1.483.6L9.807,43.912,6,47.718l7,1.818.035.009Zm75.413-5.553V47.4a6.754,6.754,0,0,1-6.746,6.747A6.462,6.462,0,0,0,83.515,60.6V60.9a6.755,6.755,0,0,0,6.747,6.747h38.2A58.9,58.9,0,0,0,117.72,36.124H106.73A10.026,10.026,0,0,0,96.716,46.139Zm17.616-20.331a61.978,61.978,0,0,1,15.84,26.724c7.819-18.52,7.757-34.049-.379-42.185-8.172-8.172-23.931-8-42.153-.361A62.221,62.221,0,0,1,114.332,25.808Z"
                  transform="translate(-389 1613)"
                ></path>
              </g>
            </svg>
            <p className="usInFigures_article-p">{kilometer.toLocaleString()}mil</p>
            <h3 className="usInFigures_article-h3">Kilómetros recorridos</h3>
          </article>
        </div>
      </section>
    </div>
  )
}
